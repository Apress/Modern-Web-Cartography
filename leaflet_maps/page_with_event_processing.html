<html>
<head>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<title>Carte OSM simple créée avec Leaflet</title>
</head>
<body>
<h1>Map to find the antipode</h1>
<div id="map" style="width: 1030px; height: 620px;"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script type="text/javascript">
window.onerror = function(message, url, linenumber) {
    if (typeof map !== 'undefined' && map) {map.remove();}
    
    const div = document.getElementById("map")
    if (div) {div.remove();}
        
    const elemDiv = document.createElement('div');
    elemDiv.innerHTML = `<p>${message}, ligne ${linenumber}</p>`;
    document.body.appendChild(elemDiv);
}
</script>
<script type="text/javascript">
let map;
try {
    map = L.map('map').setView([-15.88632, -62.22656], 4);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
         maxZoom: 19,
         attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);
    
    const popup = L.popup();

    function onMapClick(e) {
        const latlng = e.latlng;
        latlng.lat = -latlng.lat;
        if (latlng.lng > 0) {
            latlng.lng = latlng.lng - 180; 
        } else {
            latlng.lng = latlng.lng + 180; 
        }

        map.flyTo(latlng);

        popup
        .setLatLng(latlng)
        .setContent(`The antipode is there!<br>[${latlng.lat.toFixed(5)}, ${latlng.lng.toFixed(5)}]`)
        .openOn(map);
    }

    map.on('click', onMapClick);

} catch(e) {
    if (map) {map.remove();}

    document.getElementById("map").remove();
        
    const elemDiv = document.createElement('div');
    elemDiv.innerHTML = `<p>${e}</p>`;
    document.body.appendChild(elemDiv);
}

</script>
</body>
</html>
